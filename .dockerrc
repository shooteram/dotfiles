NETWORK="docker_network"
docker network inspect $NETWORK &> /dev/null

if [ $? -ne 0 ]; then
	docker network create --subnet=172.19.0.0/16 $NETWORK &> /dev/null
fi

dkr() {
	if [[ $1 == "" ]]; then
		echo "a container name is required to proceed."
		return
	fi

	CONTAINER_NAME=$1

	if [ "$(docker container list --all | grep $CONTAINER_NAME)" ]; then
		docker container stop $CONTAINER_NAME 1> /dev/null
		yes | docker container prune 1> /dev/null
	fi

	kibana_ip_address="172.19.0.30"
	elasticsearch_ip_address="172.19.0.32"

    case $CONTAINER_NAME in
	kibana)
		docker run -d -p 5601:5601 --net $NETWORK --ip $kibana_ip_address --hostname $CONTAINER_NAME \
			--name $CONTAINER_NAME kibana:6.6.0 1> /dev/null
		;;
	rabbitmq)
		docker run -d -p 15672:15672 -p 4369:4369 -p 5671:5671 -p 25672:25672 -p 5672:5672 \
			--net $NETWORK --ip 172.19.0.31 --hostname $CONTAINER_NAME \
			--name $CONTAINER_NAME rabbitmq:3-management 1> /dev/null
		;;
	elasticsearch)
		docker run -d -p 9200:9200 -p 9300:9300 \
			-e "discovery.type=single-node" \
			--net $NETWORK --ip $elasticsearch_ip_address --hostname $CONTAINER_NAME \
			--name $CONTAINER_NAME elasticsearch:6.6.0 1> /dev/null
		;;
	phpmyadmin)
		docker run -d -p 8080:80 \
			-e PMA_HOST=mariadb --link mariadb:db \
			--net $NETWORK --ip 172.19.0.33 --hostname $CONTAINER_NAME \
			--name $CONTAINER_NAME phpmyadmin/phpmyadmin 1> /dev/null
		;;
	mariadb)
		if [ ! -z "$DATABASE_PASSWORD" ]; then
			docker run -d -p 3306:3306 \
				-e MYSQL_ROOT_PASSWORD=$DATABASE_PASSWORD \
				-v/var/docker/mysql:/var/lib/mysql \
				--net $NETWORK --ip $DATABASE_IP_ADDRESS --hostname $CONTAINER_NAME \
				--name $CONTAINER_NAME mariadb 1> /dev/null
		else
			echo "The environement variable 'DATABASE_PASSWORD' is required."
			return 1
		fi
		;;
	*)
		echo "this container name is unknown"
		return
	esac

	docker ps -a --format "{{.ID}}: {{.Names}}" | grep $CONTAINER_NAME

    docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' \
        $CONTAINER_NAME && docker port $CONTAINER_NAME
}
